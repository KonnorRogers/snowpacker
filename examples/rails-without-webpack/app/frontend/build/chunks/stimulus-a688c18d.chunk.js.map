{"version":3,"file":"stimulus-a688c18d.chunk.js","sources":["../../../home/krog/projects/javascript/snowpack-plugin-rollup-bundle/__tests__/example_dir/build/web_modules/stimulus.js"],"sourcesContent":["var EventListener = /** @class */ (function () {\n    function EventListener(eventTarget, eventName) {\n        this.eventTarget = eventTarget;\n        this.eventName = eventName;\n        this.unorderedBindings = new Set;\n    }\n    EventListener.prototype.connect = function () {\n        this.eventTarget.addEventListener(this.eventName, this, false);\n    };\n    EventListener.prototype.disconnect = function () {\n        this.eventTarget.removeEventListener(this.eventName, this, false);\n    };\n    // Binding observer delegate\n    /** @hidden */\n    EventListener.prototype.bindingConnected = function (binding) {\n        this.unorderedBindings.add(binding);\n    };\n    /** @hidden */\n    EventListener.prototype.bindingDisconnected = function (binding) {\n        this.unorderedBindings.delete(binding);\n    };\n    EventListener.prototype.handleEvent = function (event) {\n        var extendedEvent = extendEvent(event);\n        for (var _i = 0, _a = this.bindings; _i < _a.length; _i++) {\n            var binding = _a[_i];\n            if (extendedEvent.immediatePropagationStopped) {\n                break;\n            }\n            else {\n                binding.handleEvent(extendedEvent);\n            }\n        }\n    };\n    Object.defineProperty(EventListener.prototype, \"bindings\", {\n        get: function () {\n            return Array.from(this.unorderedBindings).sort(function (left, right) {\n                var leftIndex = left.index, rightIndex = right.index;\n                return leftIndex < rightIndex ? -1 : leftIndex > rightIndex ? 1 : 0;\n            });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return EventListener;\n}());\nfunction extendEvent(event) {\n    if (\"immediatePropagationStopped\" in event) {\n        return event;\n    }\n    else {\n        var stopImmediatePropagation_1 = event.stopImmediatePropagation;\n        return Object.assign(event, {\n            immediatePropagationStopped: false,\n            stopImmediatePropagation: function () {\n                this.immediatePropagationStopped = true;\n                stopImmediatePropagation_1.call(this);\n            }\n        });\n    }\n}\n\nvar Dispatcher = /** @class */ (function () {\n    function Dispatcher(application) {\n        this.application = application;\n        this.eventListenerMaps = new Map;\n        this.started = false;\n    }\n    Dispatcher.prototype.start = function () {\n        if (!this.started) {\n            this.started = true;\n            this.eventListeners.forEach(function (eventListener) { return eventListener.connect(); });\n        }\n    };\n    Dispatcher.prototype.stop = function () {\n        if (this.started) {\n            this.started = false;\n            this.eventListeners.forEach(function (eventListener) { return eventListener.disconnect(); });\n        }\n    };\n    Object.defineProperty(Dispatcher.prototype, \"eventListeners\", {\n        get: function () {\n            return Array.from(this.eventListenerMaps.values())\n                .reduce(function (listeners, map) { return listeners.concat(Array.from(map.values())); }, []);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Binding observer delegate\n    /** @hidden */\n    Dispatcher.prototype.bindingConnected = function (binding) {\n        this.fetchEventListenerForBinding(binding).bindingConnected(binding);\n    };\n    /** @hidden */\n    Dispatcher.prototype.bindingDisconnected = function (binding) {\n        this.fetchEventListenerForBinding(binding).bindingDisconnected(binding);\n    };\n    // Error handling\n    Dispatcher.prototype.handleError = function (error, message, detail) {\n        if (detail === void 0) { detail = {}; }\n        this.application.handleError(error, \"Error \" + message, detail);\n    };\n    Dispatcher.prototype.fetchEventListenerForBinding = function (binding) {\n        var eventTarget = binding.eventTarget, eventName = binding.eventName;\n        return this.fetchEventListener(eventTarget, eventName);\n    };\n    Dispatcher.prototype.fetchEventListener = function (eventTarget, eventName) {\n        var eventListenerMap = this.fetchEventListenerMapForEventTarget(eventTarget);\n        var eventListener = eventListenerMap.get(eventName);\n        if (!eventListener) {\n            eventListener = this.createEventListener(eventTarget, eventName);\n            eventListenerMap.set(eventName, eventListener);\n        }\n        return eventListener;\n    };\n    Dispatcher.prototype.createEventListener = function (eventTarget, eventName) {\n        var eventListener = new EventListener(eventTarget, eventName);\n        if (this.started) {\n            eventListener.connect();\n        }\n        return eventListener;\n    };\n    Dispatcher.prototype.fetchEventListenerMapForEventTarget = function (eventTarget) {\n        var eventListenerMap = this.eventListenerMaps.get(eventTarget);\n        if (!eventListenerMap) {\n            eventListenerMap = new Map;\n            this.eventListenerMaps.set(eventTarget, eventListenerMap);\n        }\n        return eventListenerMap;\n    };\n    return Dispatcher;\n}());\n\n// capture nos.:            12   23 4               43   1 5   56 7  76\nvar descriptorPattern = /^((.+?)(@(window|document))?->)?(.+?)(#(.+))?$/;\nfunction parseDescriptorString(descriptorString) {\n    var source = descriptorString.trim();\n    var matches = source.match(descriptorPattern) || [];\n    return {\n        eventTarget: parseEventTarget(matches[4]),\n        eventName: matches[2],\n        identifier: matches[5],\n        methodName: matches[7]\n    };\n}\nfunction parseEventTarget(eventTargetName) {\n    if (eventTargetName == \"window\") {\n        return window;\n    }\n    else if (eventTargetName == \"document\") {\n        return document;\n    }\n}\nfunction stringifyEventTarget(eventTarget) {\n    if (eventTarget == window) {\n        return \"window\";\n    }\n    else if (eventTarget == document) {\n        return \"document\";\n    }\n}\n\nvar Action = /** @class */ (function () {\n    function Action(element, index, descriptor) {\n        this.element = element;\n        this.index = index;\n        this.eventTarget = descriptor.eventTarget || element;\n        this.eventName = descriptor.eventName || getDefaultEventNameForElement(element) || error(\"missing event name\");\n        this.identifier = descriptor.identifier || error(\"missing identifier\");\n        this.methodName = descriptor.methodName || error(\"missing method name\");\n    }\n    Action.forToken = function (token) {\n        return new this(token.element, token.index, parseDescriptorString(token.content));\n    };\n    Action.prototype.toString = function () {\n        var eventNameSuffix = this.eventTargetName ? \"@\" + this.eventTargetName : \"\";\n        return \"\" + this.eventName + eventNameSuffix + \"->\" + this.identifier + \"#\" + this.methodName;\n    };\n    Object.defineProperty(Action.prototype, \"eventTargetName\", {\n        get: function () {\n            return stringifyEventTarget(this.eventTarget);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Action;\n}());\nvar defaultEventNames = {\n    \"a\": function (e) { return \"click\"; },\n    \"button\": function (e) { return \"click\"; },\n    \"form\": function (e) { return \"submit\"; },\n    \"input\": function (e) { return e.getAttribute(\"type\") == \"submit\" ? \"click\" : \"change\"; },\n    \"select\": function (e) { return \"change\"; },\n    \"textarea\": function (e) { return \"change\"; }\n};\nfunction getDefaultEventNameForElement(element) {\n    var tagName = element.tagName.toLowerCase();\n    if (tagName in defaultEventNames) {\n        return defaultEventNames[tagName](element);\n    }\n}\nfunction error(message) {\n    throw new Error(message);\n}\n\nvar Binding = /** @class */ (function () {\n    function Binding(context, action) {\n        this.context = context;\n        this.action = action;\n    }\n    Object.defineProperty(Binding.prototype, \"index\", {\n        get: function () {\n            return this.action.index;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"eventTarget\", {\n        get: function () {\n            return this.action.eventTarget;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"identifier\", {\n        get: function () {\n            return this.context.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Binding.prototype.handleEvent = function (event) {\n        if (this.willBeInvokedByEvent(event)) {\n            this.invokeWithEvent(event);\n        }\n    };\n    Object.defineProperty(Binding.prototype, \"eventName\", {\n        get: function () {\n            return this.action.eventName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"method\", {\n        get: function () {\n            var method = this.controller[this.methodName];\n            if (typeof method == \"function\") {\n                return method;\n            }\n            throw new Error(\"Action \\\"\" + this.action + \"\\\" references undefined method \\\"\" + this.methodName + \"\\\"\");\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Binding.prototype.invokeWithEvent = function (event) {\n        try {\n            this.method.call(this.controller, event);\n        }\n        catch (error) {\n            var _a = this, identifier = _a.identifier, controller = _a.controller, element = _a.element, index = _a.index;\n            var detail = { identifier: identifier, controller: controller, element: element, index: index, event: event };\n            this.context.handleError(error, \"invoking action \\\"\" + this.action + \"\\\"\", detail);\n        }\n    };\n    Binding.prototype.willBeInvokedByEvent = function (event) {\n        var eventTarget = event.target;\n        if (this.element === eventTarget) {\n            return true;\n        }\n        else if (eventTarget instanceof Element && this.element.contains(eventTarget)) {\n            return this.scope.containsElement(eventTarget);\n        }\n        else {\n            return true;\n        }\n    };\n    Object.defineProperty(Binding.prototype, \"controller\", {\n        get: function () {\n            return this.context.controller;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"methodName\", {\n        get: function () {\n            return this.action.methodName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"scope\", {\n        get: function () {\n            return this.context.scope;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Binding;\n}());\n\nvar ElementObserver = /** @class */ (function () {\n    function ElementObserver(element, delegate) {\n        var _this = this;\n        this.element = element;\n        this.started = false;\n        this.delegate = delegate;\n        this.elements = new Set;\n        this.mutationObserver = new MutationObserver(function (mutations) { return _this.processMutations(mutations); });\n    }\n    ElementObserver.prototype.start = function () {\n        if (!this.started) {\n            this.started = true;\n            this.mutationObserver.observe(this.element, { attributes: true, childList: true, subtree: true });\n            this.refresh();\n        }\n    };\n    ElementObserver.prototype.stop = function () {\n        if (this.started) {\n            this.mutationObserver.takeRecords();\n            this.mutationObserver.disconnect();\n            this.started = false;\n        }\n    };\n    ElementObserver.prototype.refresh = function () {\n        if (this.started) {\n            var matches = new Set(this.matchElementsInTree());\n            for (var _i = 0, _a = Array.from(this.elements); _i < _a.length; _i++) {\n                var element = _a[_i];\n                if (!matches.has(element)) {\n                    this.removeElement(element);\n                }\n            }\n            for (var _b = 0, _c = Array.from(matches); _b < _c.length; _b++) {\n                var element = _c[_b];\n                this.addElement(element);\n            }\n        }\n    };\n    // Mutation record processing\n    ElementObserver.prototype.processMutations = function (mutations) {\n        if (this.started) {\n            for (var _i = 0, mutations_1 = mutations; _i < mutations_1.length; _i++) {\n                var mutation = mutations_1[_i];\n                this.processMutation(mutation);\n            }\n        }\n    };\n    ElementObserver.prototype.processMutation = function (mutation) {\n        if (mutation.type == \"attributes\") {\n            this.processAttributeChange(mutation.target, mutation.attributeName);\n        }\n        else if (mutation.type == \"childList\") {\n            this.processRemovedNodes(mutation.removedNodes);\n            this.processAddedNodes(mutation.addedNodes);\n        }\n    };\n    ElementObserver.prototype.processAttributeChange = function (node, attributeName) {\n        var element = node;\n        if (this.elements.has(element)) {\n            if (this.delegate.elementAttributeChanged && this.matchElement(element)) {\n                this.delegate.elementAttributeChanged(element, attributeName);\n            }\n            else {\n                this.removeElement(element);\n            }\n        }\n        else if (this.matchElement(element)) {\n            this.addElement(element);\n        }\n    };\n    ElementObserver.prototype.processRemovedNodes = function (nodes) {\n        for (var _i = 0, _a = Array.from(nodes); _i < _a.length; _i++) {\n            var node = _a[_i];\n            var element = this.elementFromNode(node);\n            if (element) {\n                this.processTree(element, this.removeElement);\n            }\n        }\n    };\n    ElementObserver.prototype.processAddedNodes = function (nodes) {\n        for (var _i = 0, _a = Array.from(nodes); _i < _a.length; _i++) {\n            var node = _a[_i];\n            var element = this.elementFromNode(node);\n            if (element && this.elementIsActive(element)) {\n                this.processTree(element, this.addElement);\n            }\n        }\n    };\n    // Element matching\n    ElementObserver.prototype.matchElement = function (element) {\n        return this.delegate.matchElement(element);\n    };\n    ElementObserver.prototype.matchElementsInTree = function (tree) {\n        if (tree === void 0) { tree = this.element; }\n        return this.delegate.matchElementsInTree(tree);\n    };\n    ElementObserver.prototype.processTree = function (tree, processor) {\n        for (var _i = 0, _a = this.matchElementsInTree(tree); _i < _a.length; _i++) {\n            var element = _a[_i];\n            processor.call(this, element);\n        }\n    };\n    ElementObserver.prototype.elementFromNode = function (node) {\n        if (node.nodeType == Node.ELEMENT_NODE) {\n            return node;\n        }\n    };\n    ElementObserver.prototype.elementIsActive = function (element) {\n        if (element.isConnected != this.element.isConnected) {\n            return false;\n        }\n        else {\n            return this.element.contains(element);\n        }\n    };\n    // Element tracking\n    ElementObserver.prototype.addElement = function (element) {\n        if (!this.elements.has(element)) {\n            if (this.elementIsActive(element)) {\n                this.elements.add(element);\n                if (this.delegate.elementMatched) {\n                    this.delegate.elementMatched(element);\n                }\n            }\n        }\n    };\n    ElementObserver.prototype.removeElement = function (element) {\n        if (this.elements.has(element)) {\n            this.elements.delete(element);\n            if (this.delegate.elementUnmatched) {\n                this.delegate.elementUnmatched(element);\n            }\n        }\n    };\n    return ElementObserver;\n}());\n\nvar AttributeObserver = /** @class */ (function () {\n    function AttributeObserver(element, attributeName, delegate) {\n        this.attributeName = attributeName;\n        this.delegate = delegate;\n        this.elementObserver = new ElementObserver(element, this);\n    }\n    Object.defineProperty(AttributeObserver.prototype, \"element\", {\n        get: function () {\n            return this.elementObserver.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(AttributeObserver.prototype, \"selector\", {\n        get: function () {\n            return \"[\" + this.attributeName + \"]\";\n        },\n        enumerable: true,\n        configurable: true\n    });\n    AttributeObserver.prototype.start = function () {\n        this.elementObserver.start();\n    };\n    AttributeObserver.prototype.stop = function () {\n        this.elementObserver.stop();\n    };\n    AttributeObserver.prototype.refresh = function () {\n        this.elementObserver.refresh();\n    };\n    Object.defineProperty(AttributeObserver.prototype, \"started\", {\n        get: function () {\n            return this.elementObserver.started;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Element observer delegate\n    AttributeObserver.prototype.matchElement = function (element) {\n        return element.hasAttribute(this.attributeName);\n    };\n    AttributeObserver.prototype.matchElementsInTree = function (tree) {\n        var match = this.matchElement(tree) ? [tree] : [];\n        var matches = Array.from(tree.querySelectorAll(this.selector));\n        return match.concat(matches);\n    };\n    AttributeObserver.prototype.elementMatched = function (element) {\n        if (this.delegate.elementMatchedAttribute) {\n            this.delegate.elementMatchedAttribute(element, this.attributeName);\n        }\n    };\n    AttributeObserver.prototype.elementUnmatched = function (element) {\n        if (this.delegate.elementUnmatchedAttribute) {\n            this.delegate.elementUnmatchedAttribute(element, this.attributeName);\n        }\n    };\n    AttributeObserver.prototype.elementAttributeChanged = function (element, attributeName) {\n        if (this.delegate.elementAttributeValueChanged && this.attributeName == attributeName) {\n            this.delegate.elementAttributeValueChanged(element, attributeName);\n        }\n    };\n    return AttributeObserver;\n}());\n\nfunction add(map, key, value) {\n    fetch(map, key).add(value);\n}\nfunction del(map, key, value) {\n    fetch(map, key).delete(value);\n    prune(map, key);\n}\nfunction fetch(map, key) {\n    var values = map.get(key);\n    if (!values) {\n        values = new Set();\n        map.set(key, values);\n    }\n    return values;\n}\nfunction prune(map, key) {\n    var values = map.get(key);\n    if (values != null && values.size == 0) {\n        map.delete(key);\n    }\n}\n\nvar Multimap = /** @class */ (function () {\n    function Multimap() {\n        this.valuesByKey = new Map();\n    }\n    Object.defineProperty(Multimap.prototype, \"values\", {\n        get: function () {\n            var sets = Array.from(this.valuesByKey.values());\n            return sets.reduce(function (values, set) { return values.concat(Array.from(set)); }, []);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Multimap.prototype, \"size\", {\n        get: function () {\n            var sets = Array.from(this.valuesByKey.values());\n            return sets.reduce(function (size, set) { return size + set.size; }, 0);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Multimap.prototype.add = function (key, value) {\n        add(this.valuesByKey, key, value);\n    };\n    Multimap.prototype.delete = function (key, value) {\n        del(this.valuesByKey, key, value);\n    };\n    Multimap.prototype.has = function (key, value) {\n        var values = this.valuesByKey.get(key);\n        return values != null && values.has(value);\n    };\n    Multimap.prototype.hasKey = function (key) {\n        return this.valuesByKey.has(key);\n    };\n    Multimap.prototype.hasValue = function (value) {\n        var sets = Array.from(this.valuesByKey.values());\n        return sets.some(function (set) { return set.has(value); });\n    };\n    Multimap.prototype.getValuesForKey = function (key) {\n        var values = this.valuesByKey.get(key);\n        return values ? Array.from(values) : [];\n    };\n    Multimap.prototype.getKeysForValue = function (value) {\n        return Array.from(this.valuesByKey)\n            .filter(function (_a) {\n            var key = _a[0], values = _a[1];\n            return values.has(value);\n        })\n            .map(function (_a) {\n            var key = _a[0], values = _a[1];\n            return key;\n        });\n    };\n    return Multimap;\n}());\n\nvar __extends = (undefined && undefined.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar IndexedMultimap = /** @class */ (function (_super) {\n    __extends(IndexedMultimap, _super);\n    function IndexedMultimap() {\n        var _this = _super.call(this) || this;\n        _this.keysByValue = new Map;\n        return _this;\n    }\n    Object.defineProperty(IndexedMultimap.prototype, \"values\", {\n        get: function () {\n            return Array.from(this.keysByValue.keys());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    IndexedMultimap.prototype.add = function (key, value) {\n        _super.prototype.add.call(this, key, value);\n        add(this.keysByValue, value, key);\n    };\n    IndexedMultimap.prototype.delete = function (key, value) {\n        _super.prototype.delete.call(this, key, value);\n        del(this.keysByValue, value, key);\n    };\n    IndexedMultimap.prototype.hasValue = function (value) {\n        return this.keysByValue.has(value);\n    };\n    IndexedMultimap.prototype.getKeysForValue = function (value) {\n        var set = this.keysByValue.get(value);\n        return set ? Array.from(set) : [];\n    };\n    return IndexedMultimap;\n}(Multimap));\n\nvar TokenListObserver = /** @class */ (function () {\n    function TokenListObserver(element, attributeName, delegate) {\n        this.attributeObserver = new AttributeObserver(element, attributeName, this);\n        this.delegate = delegate;\n        this.tokensByElement = new Multimap;\n    }\n    Object.defineProperty(TokenListObserver.prototype, \"started\", {\n        get: function () {\n            return this.attributeObserver.started;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    TokenListObserver.prototype.start = function () {\n        this.attributeObserver.start();\n    };\n    TokenListObserver.prototype.stop = function () {\n        this.attributeObserver.stop();\n    };\n    TokenListObserver.prototype.refresh = function () {\n        this.attributeObserver.refresh();\n    };\n    Object.defineProperty(TokenListObserver.prototype, \"element\", {\n        get: function () {\n            return this.attributeObserver.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TokenListObserver.prototype, \"attributeName\", {\n        get: function () {\n            return this.attributeObserver.attributeName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Attribute observer delegate\n    TokenListObserver.prototype.elementMatchedAttribute = function (element) {\n        this.tokensMatched(this.readTokensForElement(element));\n    };\n    TokenListObserver.prototype.elementAttributeValueChanged = function (element) {\n        var _a = this.refreshTokensForElement(element), unmatchedTokens = _a[0], matchedTokens = _a[1];\n        this.tokensUnmatched(unmatchedTokens);\n        this.tokensMatched(matchedTokens);\n    };\n    TokenListObserver.prototype.elementUnmatchedAttribute = function (element) {\n        this.tokensUnmatched(this.tokensByElement.getValuesForKey(element));\n    };\n    TokenListObserver.prototype.tokensMatched = function (tokens) {\n        var _this = this;\n        tokens.forEach(function (token) { return _this.tokenMatched(token); });\n    };\n    TokenListObserver.prototype.tokensUnmatched = function (tokens) {\n        var _this = this;\n        tokens.forEach(function (token) { return _this.tokenUnmatched(token); });\n    };\n    TokenListObserver.prototype.tokenMatched = function (token) {\n        this.delegate.tokenMatched(token);\n        this.tokensByElement.add(token.element, token);\n    };\n    TokenListObserver.prototype.tokenUnmatched = function (token) {\n        this.delegate.tokenUnmatched(token);\n        this.tokensByElement.delete(token.element, token);\n    };\n    TokenListObserver.prototype.refreshTokensForElement = function (element) {\n        var previousTokens = this.tokensByElement.getValuesForKey(element);\n        var currentTokens = this.readTokensForElement(element);\n        var firstDifferingIndex = zip(previousTokens, currentTokens)\n            .findIndex(function (_a) {\n            var previousToken = _a[0], currentToken = _a[1];\n            return !tokensAreEqual(previousToken, currentToken);\n        });\n        if (firstDifferingIndex == -1) {\n            return [[], []];\n        }\n        else {\n            return [previousTokens.slice(firstDifferingIndex), currentTokens.slice(firstDifferingIndex)];\n        }\n    };\n    TokenListObserver.prototype.readTokensForElement = function (element) {\n        var attributeName = this.attributeName;\n        var tokenString = element.getAttribute(attributeName) || \"\";\n        return parseTokenString(tokenString, element, attributeName);\n    };\n    return TokenListObserver;\n}());\nfunction parseTokenString(tokenString, element, attributeName) {\n    return tokenString.trim().split(/\\s+/).filter(function (content) { return content.length; })\n        .map(function (content, index) { return ({ element: element, attributeName: attributeName, content: content, index: index }); });\n}\nfunction zip(left, right) {\n    var length = Math.max(left.length, right.length);\n    return Array.from({ length: length }, function (_, index) { return [left[index], right[index]]; });\n}\nfunction tokensAreEqual(left, right) {\n    return left && right && left.index == right.index && left.content == right.content;\n}\n\nvar ValueListObserver = /** @class */ (function () {\n    function ValueListObserver(element, attributeName, delegate) {\n        this.tokenListObserver = new TokenListObserver(element, attributeName, this);\n        this.delegate = delegate;\n        this.parseResultsByToken = new WeakMap;\n        this.valuesByTokenByElement = new WeakMap;\n    }\n    Object.defineProperty(ValueListObserver.prototype, \"started\", {\n        get: function () {\n            return this.tokenListObserver.started;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ValueListObserver.prototype.start = function () {\n        this.tokenListObserver.start();\n    };\n    ValueListObserver.prototype.stop = function () {\n        this.tokenListObserver.stop();\n    };\n    ValueListObserver.prototype.refresh = function () {\n        this.tokenListObserver.refresh();\n    };\n    Object.defineProperty(ValueListObserver.prototype, \"element\", {\n        get: function () {\n            return this.tokenListObserver.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ValueListObserver.prototype, \"attributeName\", {\n        get: function () {\n            return this.tokenListObserver.attributeName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ValueListObserver.prototype.tokenMatched = function (token) {\n        var element = token.element;\n        var value = this.fetchParseResultForToken(token).value;\n        if (value) {\n            this.fetchValuesByTokenForElement(element).set(token, value);\n            this.delegate.elementMatchedValue(element, value);\n        }\n    };\n    ValueListObserver.prototype.tokenUnmatched = function (token) {\n        var element = token.element;\n        var value = this.fetchParseResultForToken(token).value;\n        if (value) {\n            this.fetchValuesByTokenForElement(element).delete(token);\n            this.delegate.elementUnmatchedValue(element, value);\n        }\n    };\n    ValueListObserver.prototype.fetchParseResultForToken = function (token) {\n        var parseResult = this.parseResultsByToken.get(token);\n        if (!parseResult) {\n            parseResult = this.parseToken(token);\n            this.parseResultsByToken.set(token, parseResult);\n        }\n        return parseResult;\n    };\n    ValueListObserver.prototype.fetchValuesByTokenForElement = function (element) {\n        var valuesByToken = this.valuesByTokenByElement.get(element);\n        if (!valuesByToken) {\n            valuesByToken = new Map;\n            this.valuesByTokenByElement.set(element, valuesByToken);\n        }\n        return valuesByToken;\n    };\n    ValueListObserver.prototype.parseToken = function (token) {\n        try {\n            var value = this.delegate.parseValueForToken(token);\n            return { value: value };\n        }\n        catch (error) {\n            return { error: error };\n        }\n    };\n    return ValueListObserver;\n}());\n\nvar BindingObserver = /** @class */ (function () {\n    function BindingObserver(context, delegate) {\n        this.context = context;\n        this.delegate = delegate;\n        this.bindingsByAction = new Map;\n    }\n    BindingObserver.prototype.start = function () {\n        if (!this.valueListObserver) {\n            this.valueListObserver = new ValueListObserver(this.element, this.actionAttribute, this);\n            this.valueListObserver.start();\n        }\n    };\n    BindingObserver.prototype.stop = function () {\n        if (this.valueListObserver) {\n            this.valueListObserver.stop();\n            delete this.valueListObserver;\n            this.disconnectAllActions();\n        }\n    };\n    Object.defineProperty(BindingObserver.prototype, \"element\", {\n        get: function () {\n            return this.context.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"identifier\", {\n        get: function () {\n            return this.context.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"actionAttribute\", {\n        get: function () {\n            return this.schema.actionAttribute;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"schema\", {\n        get: function () {\n            return this.context.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"bindings\", {\n        get: function () {\n            return Array.from(this.bindingsByAction.values());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    BindingObserver.prototype.connectAction = function (action) {\n        var binding = new Binding(this.context, action);\n        this.bindingsByAction.set(action, binding);\n        this.delegate.bindingConnected(binding);\n    };\n    BindingObserver.prototype.disconnectAction = function (action) {\n        var binding = this.bindingsByAction.get(action);\n        if (binding) {\n            this.bindingsByAction.delete(action);\n            this.delegate.bindingDisconnected(binding);\n        }\n    };\n    BindingObserver.prototype.disconnectAllActions = function () {\n        var _this = this;\n        this.bindings.forEach(function (binding) { return _this.delegate.bindingDisconnected(binding); });\n        this.bindingsByAction.clear();\n    };\n    // Value observer delegate\n    BindingObserver.prototype.parseValueForToken = function (token) {\n        var action = Action.forToken(token);\n        if (action.identifier == this.identifier) {\n            return action;\n        }\n    };\n    BindingObserver.prototype.elementMatchedValue = function (element, action) {\n        this.connectAction(action);\n    };\n    BindingObserver.prototype.elementUnmatchedValue = function (element, action) {\n        this.disconnectAction(action);\n    };\n    return BindingObserver;\n}());\n\nvar Context = /** @class */ (function () {\n    function Context(module, scope) {\n        this.module = module;\n        this.scope = scope;\n        this.controller = new module.controllerConstructor(this);\n        this.bindingObserver = new BindingObserver(this, this.dispatcher);\n        try {\n            this.controller.initialize();\n        }\n        catch (error) {\n            this.handleError(error, \"initializing controller\");\n        }\n    }\n    Context.prototype.connect = function () {\n        this.bindingObserver.start();\n        try {\n            this.controller.connect();\n        }\n        catch (error) {\n            this.handleError(error, \"connecting controller\");\n        }\n    };\n    Context.prototype.disconnect = function () {\n        try {\n            this.controller.disconnect();\n        }\n        catch (error) {\n            this.handleError(error, \"disconnecting controller\");\n        }\n        this.bindingObserver.stop();\n    };\n    Object.defineProperty(Context.prototype, \"application\", {\n        get: function () {\n            return this.module.application;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"identifier\", {\n        get: function () {\n            return this.module.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"schema\", {\n        get: function () {\n            return this.application.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"dispatcher\", {\n        get: function () {\n            return this.application.dispatcher;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"parentElement\", {\n        get: function () {\n            return this.element.parentElement;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Error handling\n    Context.prototype.handleError = function (error, message, detail) {\n        if (detail === void 0) { detail = {}; }\n        var _a = this, identifier = _a.identifier, controller = _a.controller, element = _a.element;\n        detail = Object.assign({ identifier: identifier, controller: controller, element: element }, detail);\n        this.application.handleError(error, \"Error \" + message, detail);\n    };\n    return Context;\n}());\n\nvar __extends$1 = (undefined && undefined.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/** @hidden */\nfunction blessDefinition(definition) {\n    return {\n        identifier: definition.identifier,\n        controllerConstructor: blessControllerConstructor(definition.controllerConstructor)\n    };\n}\nfunction blessControllerConstructor(controllerConstructor) {\n    var constructor = extend(controllerConstructor);\n    constructor.bless();\n    return constructor;\n}\nvar extend = (function () {\n    function extendWithReflect(constructor) {\n        function Controller() {\n            var _newTarget = this && this instanceof Controller ? this.constructor : void 0;\n            return Reflect.construct(constructor, arguments, _newTarget);\n        }\n        Controller.prototype = Object.create(constructor.prototype, {\n            constructor: { value: Controller }\n        });\n        Reflect.setPrototypeOf(Controller, constructor);\n        return Controller;\n    }\n    function testReflectExtension() {\n        var a = function () { this.a.call(this); };\n        var b = extendWithReflect(a);\n        b.prototype.a = function () { };\n        return new b;\n    }\n    try {\n        testReflectExtension();\n        return extendWithReflect;\n    }\n    catch (error) {\n        return function (constructor) { return /** @class */ (function (_super) {\n            __extends$1(Controller, _super);\n            function Controller() {\n                return _super !== null && _super.apply(this, arguments) || this;\n            }\n            return Controller;\n        }(constructor)); };\n    }\n})();\n\nvar Module = /** @class */ (function () {\n    function Module(application, definition) {\n        this.application = application;\n        this.definition = blessDefinition(definition);\n        this.contextsByScope = new WeakMap;\n        this.connectedContexts = new Set;\n    }\n    Object.defineProperty(Module.prototype, \"identifier\", {\n        get: function () {\n            return this.definition.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Module.prototype, \"controllerConstructor\", {\n        get: function () {\n            return this.definition.controllerConstructor;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Module.prototype, \"contexts\", {\n        get: function () {\n            return Array.from(this.connectedContexts);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Module.prototype.connectContextForScope = function (scope) {\n        var context = this.fetchContextForScope(scope);\n        this.connectedContexts.add(context);\n        context.connect();\n    };\n    Module.prototype.disconnectContextForScope = function (scope) {\n        var context = this.contextsByScope.get(scope);\n        if (context) {\n            this.connectedContexts.delete(context);\n            context.disconnect();\n        }\n    };\n    Module.prototype.fetchContextForScope = function (scope) {\n        var context = this.contextsByScope.get(scope);\n        if (!context) {\n            context = new Context(this, scope);\n            this.contextsByScope.set(scope, context);\n        }\n        return context;\n    };\n    return Module;\n}());\n\nvar DataMap = /** @class */ (function () {\n    function DataMap(scope) {\n        this.scope = scope;\n    }\n    Object.defineProperty(DataMap.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DataMap.prototype, \"identifier\", {\n        get: function () {\n            return this.scope.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DataMap.prototype.get = function (key) {\n        key = this.getFormattedKey(key);\n        return this.element.getAttribute(key);\n    };\n    DataMap.prototype.set = function (key, value) {\n        key = this.getFormattedKey(key);\n        this.element.setAttribute(key, value);\n        return this.get(key);\n    };\n    DataMap.prototype.has = function (key) {\n        key = this.getFormattedKey(key);\n        return this.element.hasAttribute(key);\n    };\n    DataMap.prototype.delete = function (key) {\n        if (this.has(key)) {\n            key = this.getFormattedKey(key);\n            this.element.removeAttribute(key);\n            return true;\n        }\n        else {\n            return false;\n        }\n    };\n    DataMap.prototype.getFormattedKey = function (key) {\n        return \"data-\" + this.identifier + \"-\" + dasherize(key);\n    };\n    return DataMap;\n}());\nfunction dasherize(value) {\n    return value.replace(/([A-Z])/g, function (_, char) { return \"-\" + char.toLowerCase(); });\n}\n\n/** @hidden */\nfunction attributeValueContainsToken(attributeName, token) {\n    return \"[\" + attributeName + \"~=\\\"\" + token + \"\\\"]\";\n}\n\nvar TargetSet = /** @class */ (function () {\n    function TargetSet(scope) {\n        this.scope = scope;\n    }\n    Object.defineProperty(TargetSet.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TargetSet.prototype, \"identifier\", {\n        get: function () {\n            return this.scope.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TargetSet.prototype, \"schema\", {\n        get: function () {\n            return this.scope.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    TargetSet.prototype.has = function (targetName) {\n        return this.find(targetName) != null;\n    };\n    TargetSet.prototype.find = function () {\n        var targetNames = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            targetNames[_i] = arguments[_i];\n        }\n        var selector = this.getSelectorForTargetNames(targetNames);\n        return this.scope.findElement(selector);\n    };\n    TargetSet.prototype.findAll = function () {\n        var targetNames = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            targetNames[_i] = arguments[_i];\n        }\n        var selector = this.getSelectorForTargetNames(targetNames);\n        return this.scope.findAllElements(selector);\n    };\n    TargetSet.prototype.getSelectorForTargetNames = function (targetNames) {\n        var _this = this;\n        return targetNames.map(function (targetName) { return _this.getSelectorForTargetName(targetName); }).join(\", \");\n    };\n    TargetSet.prototype.getSelectorForTargetName = function (targetName) {\n        var targetDescriptor = this.identifier + \".\" + targetName;\n        return attributeValueContainsToken(this.schema.targetAttribute, targetDescriptor);\n    };\n    return TargetSet;\n}());\n\nvar Scope = /** @class */ (function () {\n    function Scope(schema, identifier, element) {\n        this.schema = schema;\n        this.identifier = identifier;\n        this.element = element;\n        this.targets = new TargetSet(this);\n        this.data = new DataMap(this);\n    }\n    Scope.prototype.findElement = function (selector) {\n        return this.findAllElements(selector)[0];\n    };\n    Scope.prototype.findAllElements = function (selector) {\n        var head = this.element.matches(selector) ? [this.element] : [];\n        var tail = this.filterElements(Array.from(this.element.querySelectorAll(selector)));\n        return head.concat(tail);\n    };\n    Scope.prototype.filterElements = function (elements) {\n        var _this = this;\n        return elements.filter(function (element) { return _this.containsElement(element); });\n    };\n    Scope.prototype.containsElement = function (element) {\n        return element.closest(this.controllerSelector) === this.element;\n    };\n    Object.defineProperty(Scope.prototype, \"controllerSelector\", {\n        get: function () {\n            return attributeValueContainsToken(this.schema.controllerAttribute, this.identifier);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Scope;\n}());\n\nvar ScopeObserver = /** @class */ (function () {\n    function ScopeObserver(element, schema, delegate) {\n        this.element = element;\n        this.schema = schema;\n        this.delegate = delegate;\n        this.valueListObserver = new ValueListObserver(this.element, this.controllerAttribute, this);\n        this.scopesByIdentifierByElement = new WeakMap;\n        this.scopeReferenceCounts = new WeakMap;\n    }\n    ScopeObserver.prototype.start = function () {\n        this.valueListObserver.start();\n    };\n    ScopeObserver.prototype.stop = function () {\n        this.valueListObserver.stop();\n    };\n    Object.defineProperty(ScopeObserver.prototype, \"controllerAttribute\", {\n        get: function () {\n            return this.schema.controllerAttribute;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Value observer delegate\n    /** @hidden */\n    ScopeObserver.prototype.parseValueForToken = function (token) {\n        var element = token.element, identifier = token.content;\n        var scopesByIdentifier = this.fetchScopesByIdentifierForElement(element);\n        var scope = scopesByIdentifier.get(identifier);\n        if (!scope) {\n            scope = new Scope(this.schema, identifier, element);\n            scopesByIdentifier.set(identifier, scope);\n        }\n        return scope;\n    };\n    /** @hidden */\n    ScopeObserver.prototype.elementMatchedValue = function (element, value) {\n        var referenceCount = (this.scopeReferenceCounts.get(value) || 0) + 1;\n        this.scopeReferenceCounts.set(value, referenceCount);\n        if (referenceCount == 1) {\n            this.delegate.scopeConnected(value);\n        }\n    };\n    /** @hidden */\n    ScopeObserver.prototype.elementUnmatchedValue = function (element, value) {\n        var referenceCount = this.scopeReferenceCounts.get(value);\n        if (referenceCount) {\n            this.scopeReferenceCounts.set(value, referenceCount - 1);\n            if (referenceCount == 1) {\n                this.delegate.scopeDisconnected(value);\n            }\n        }\n    };\n    ScopeObserver.prototype.fetchScopesByIdentifierForElement = function (element) {\n        var scopesByIdentifier = this.scopesByIdentifierByElement.get(element);\n        if (!scopesByIdentifier) {\n            scopesByIdentifier = new Map;\n            this.scopesByIdentifierByElement.set(element, scopesByIdentifier);\n        }\n        return scopesByIdentifier;\n    };\n    return ScopeObserver;\n}());\n\nvar Router = /** @class */ (function () {\n    function Router(application) {\n        this.application = application;\n        this.scopeObserver = new ScopeObserver(this.element, this.schema, this);\n        this.scopesByIdentifier = new Multimap;\n        this.modulesByIdentifier = new Map;\n    }\n    Object.defineProperty(Router.prototype, \"element\", {\n        get: function () {\n            return this.application.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"schema\", {\n        get: function () {\n            return this.application.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"controllerAttribute\", {\n        get: function () {\n            return this.schema.controllerAttribute;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"modules\", {\n        get: function () {\n            return Array.from(this.modulesByIdentifier.values());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"contexts\", {\n        get: function () {\n            return this.modules.reduce(function (contexts, module) { return contexts.concat(module.contexts); }, []);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Router.prototype.start = function () {\n        this.scopeObserver.start();\n    };\n    Router.prototype.stop = function () {\n        this.scopeObserver.stop();\n    };\n    Router.prototype.loadDefinition = function (definition) {\n        this.unloadIdentifier(definition.identifier);\n        var module = new Module(this.application, definition);\n        this.connectModule(module);\n    };\n    Router.prototype.unloadIdentifier = function (identifier) {\n        var module = this.modulesByIdentifier.get(identifier);\n        if (module) {\n            this.disconnectModule(module);\n        }\n    };\n    Router.prototype.getContextForElementAndIdentifier = function (element, identifier) {\n        var module = this.modulesByIdentifier.get(identifier);\n        if (module) {\n            return module.contexts.find(function (context) { return context.element == element; });\n        }\n    };\n    // Error handler delegate\n    /** @hidden */\n    Router.prototype.handleError = function (error, message, detail) {\n        this.application.handleError(error, message, detail);\n    };\n    // Scope observer delegate\n    /** @hidden */\n    Router.prototype.scopeConnected = function (scope) {\n        this.scopesByIdentifier.add(scope.identifier, scope);\n        var module = this.modulesByIdentifier.get(scope.identifier);\n        if (module) {\n            module.connectContextForScope(scope);\n        }\n    };\n    /** @hidden */\n    Router.prototype.scopeDisconnected = function (scope) {\n        this.scopesByIdentifier.delete(scope.identifier, scope);\n        var module = this.modulesByIdentifier.get(scope.identifier);\n        if (module) {\n            module.disconnectContextForScope(scope);\n        }\n    };\n    // Modules\n    Router.prototype.connectModule = function (module) {\n        this.modulesByIdentifier.set(module.identifier, module);\n        var scopes = this.scopesByIdentifier.getValuesForKey(module.identifier);\n        scopes.forEach(function (scope) { return module.connectContextForScope(scope); });\n    };\n    Router.prototype.disconnectModule = function (module) {\n        this.modulesByIdentifier.delete(module.identifier);\n        var scopes = this.scopesByIdentifier.getValuesForKey(module.identifier);\n        scopes.forEach(function (scope) { return module.disconnectContextForScope(scope); });\n    };\n    return Router;\n}());\n\nvar defaultSchema = {\n    controllerAttribute: \"data-controller\",\n    actionAttribute: \"data-action\",\n    targetAttribute: \"data-target\"\n};\n\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (undefined && undefined.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar Application = /** @class */ (function () {\n    function Application(element, schema) {\n        if (element === void 0) { element = document.documentElement; }\n        if (schema === void 0) { schema = defaultSchema; }\n        this.element = element;\n        this.schema = schema;\n        this.dispatcher = new Dispatcher(this);\n        this.router = new Router(this);\n    }\n    Application.start = function (element, schema) {\n        var application = new Application(element, schema);\n        application.start();\n        return application;\n    };\n    Application.prototype.start = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, domReady()];\n                    case 1:\n                        _a.sent();\n                        this.router.start();\n                        this.dispatcher.start();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Application.prototype.stop = function () {\n        this.router.stop();\n        this.dispatcher.stop();\n    };\n    Application.prototype.register = function (identifier, controllerConstructor) {\n        this.load({ identifier: identifier, controllerConstructor: controllerConstructor });\n    };\n    Application.prototype.load = function (head) {\n        var _this = this;\n        var rest = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            rest[_i - 1] = arguments[_i];\n        }\n        var definitions = Array.isArray(head) ? head : [head].concat(rest);\n        definitions.forEach(function (definition) { return _this.router.loadDefinition(definition); });\n    };\n    Application.prototype.unload = function (head) {\n        var _this = this;\n        var rest = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            rest[_i - 1] = arguments[_i];\n        }\n        var identifiers = Array.isArray(head) ? head : [head].concat(rest);\n        identifiers.forEach(function (identifier) { return _this.router.unloadIdentifier(identifier); });\n    };\n    Object.defineProperty(Application.prototype, \"controllers\", {\n        // Controllers\n        get: function () {\n            return this.router.contexts.map(function (context) { return context.controller; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Application.prototype.getControllerForElementAndIdentifier = function (element, identifier) {\n        var context = this.router.getContextForElementAndIdentifier(element, identifier);\n        return context ? context.controller : null;\n    };\n    // Error handling\n    Application.prototype.handleError = function (error, message, detail) {\n        console.error(\"%s\\n\\n%o\\n\\n%o\", message, error, detail);\n    };\n    return Application;\n}());\nfunction domReady() {\n    return new Promise(function (resolve) {\n        if (document.readyState == \"loading\") {\n            document.addEventListener(\"DOMContentLoaded\", resolve);\n        }\n        else {\n            resolve();\n        }\n    });\n}\n\n/** @hidden */\nfunction defineTargetProperties(constructor) {\n    var prototype = constructor.prototype;\n    var targetNames = getTargetNamesForConstructor(constructor);\n    targetNames.forEach(function (name) {\n        var _a;\n        return defineLinkedProperties(prototype, (_a = {},\n            _a[name + \"Target\"] = {\n                get: function () {\n                    var target = this.targets.find(name);\n                    if (target) {\n                        return target;\n                    }\n                    else {\n                        throw new Error(\"Missing target element \\\"\" + this.identifier + \".\" + name + \"\\\"\");\n                    }\n                }\n            },\n            _a[name + \"Targets\"] = {\n                get: function () {\n                    return this.targets.findAll(name);\n                }\n            },\n            _a[\"has\" + capitalize(name) + \"Target\"] = {\n                get: function () {\n                    return this.targets.has(name);\n                }\n            },\n            _a));\n    });\n}\nfunction getTargetNamesForConstructor(constructor) {\n    var ancestors = getAncestorsForConstructor(constructor);\n    return Array.from(ancestors.reduce(function (targetNames, constructor) {\n        getOwnTargetNamesForConstructor(constructor).forEach(function (name) { return targetNames.add(name); });\n        return targetNames;\n    }, new Set));\n}\nfunction getAncestorsForConstructor(constructor) {\n    var ancestors = [];\n    while (constructor) {\n        ancestors.push(constructor);\n        constructor = Object.getPrototypeOf(constructor);\n    }\n    return ancestors;\n}\nfunction getOwnTargetNamesForConstructor(constructor) {\n    var definition = constructor[\"targets\"];\n    return Array.isArray(definition) ? definition : [];\n}\nfunction defineLinkedProperties(object, properties) {\n    Object.keys(properties).forEach(function (name) {\n        if (!(name in object)) {\n            var descriptor = properties[name];\n            Object.defineProperty(object, name, descriptor);\n        }\n    });\n}\nfunction capitalize(name) {\n    return name.charAt(0).toUpperCase() + name.slice(1);\n}\n\nvar Controller = /** @class */ (function () {\n    function Controller(context) {\n        this.context = context;\n    }\n    Controller.bless = function () {\n        defineTargetProperties(this);\n    };\n    Object.defineProperty(Controller.prototype, \"application\", {\n        get: function () {\n            return this.context.application;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"scope\", {\n        get: function () {\n            return this.context.scope;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"identifier\", {\n        get: function () {\n            return this.scope.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"targets\", {\n        get: function () {\n            return this.scope.targets;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"data\", {\n        get: function () {\n            return this.scope.data;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Controller.prototype.initialize = function () {\n        // Override in your subclass to set up initial controller state\n    };\n    Controller.prototype.connect = function () {\n        // Override in your subclass to respond when the controller is connected to the DOM\n    };\n    Controller.prototype.disconnect = function () {\n        // Override in your subclass to respond when the controller is disconnected from the DOM\n    };\n    Controller.targets = [];\n    return Controller;\n}());\n\nexport { Application, Controller };\n"],"names":["EventListener","eventTarget","eventName","this","unorderedBindings","Set","prototype","connect","addEventListener","disconnect","removeEventListener","bindingConnected","binding","add","bindingDisconnected","delete","handleEvent","event","extendedEvent","stopImmediatePropagation_1","stopImmediatePropagation","Object","assign","immediatePropagationStopped","call","extendEvent","_i","_a","bindings","length","defineProperty","get","Array","from","sort","left","right","leftIndex","index","rightIndex","enumerable","configurable","Dispatcher","application","eventListenerMaps","Map","started","start","eventListeners","forEach","eventListener","stop","values","reduce","listeners","map","concat","fetchEventListenerForBinding","handleError","error","message","detail","fetchEventListener","eventListenerMap","fetchEventListenerMapForEventTarget","createEventListener","set","descriptorPattern","parseEventTarget","eventTargetName","window","document","Action","element","descriptor","tagName","toLowerCase","defaultEventNames","getDefaultEventNameForElement","identifier","methodName","forToken","token","descriptorString","content","matches","trim","match","toString","eventNameSuffix","a","e","button","form","input","getAttribute","select","textarea","Error","Binding","context","action","willBeInvokedByEvent","invokeWithEvent","method","controller","target","Element","contains","scope","containsElement","ElementObserver","delegate","_this","elements","mutationObserver","MutationObserver","mutations","processMutations","observe","attributes","childList","subtree","refresh","takeRecords","matchElementsInTree","has","removeElement","_b","_c","addElement","mutations_1","mutation","processMutation","type","processAttributeChange","attributeName","processRemovedNodes","removedNodes","processAddedNodes","addedNodes","node","elementAttributeChanged","matchElement","nodes","elementFromNode","processTree","elementIsActive","tree","processor","nodeType","Node","ELEMENT_NODE","isConnected","elementMatched","elementUnmatched","AttributeObserver","elementObserver","hasAttribute","querySelectorAll","selector","elementMatchedAttribute","elementUnmatchedAttribute","elementAttributeValueChanged","key","value","fetch","del","size","prune","extendStatics","Multimap","valuesByKey","hasKey","hasValue","some","getValuesForKey","getKeysForValue","filter","__extends","setPrototypeOf","__proto__","d","b","p","hasOwnProperty","__","constructor","create","TokenListObserver","_super","IndexedMultimap","keysByValue","keys","attributeObserver","tokensByElement","tokensMatched","readTokensForElement","refreshTokensForElement","unmatchedTokens","matchedTokens","tokensUnmatched","tokens","tokenMatched","tokenUnmatched","previousTokens","currentTokens","firstDifferingIndex","Math","max","_","findIndex","tokensAreEqual","slice","tokenString","split","parseTokenString","ValueListObserver","tokenListObserver","parseResultsByToken","WeakMap","valuesByTokenByElement","fetchParseResultForToken","fetchValuesByTokenForElement","elementMatchedValue","elementUnmatchedValue","parseResult","parseToken","valuesByToken","parseValueForToken","BindingObserver","bindingsByAction","valueListObserver","actionAttribute","disconnectAllActions","schema","connectAction","disconnectAction","clear","Context","module","controllerConstructor","bindingObserver","dispatcher","initialize","parentElement","__extends$1","blessControllerConstructor","extend","bless","extendWithReflect","Controller","_newTarget","Reflect","construct","arguments","apply","Module","definition","blessDefinition","contextsByScope","connectedContexts","connectContextForScope","fetchContextForScope","disconnectContextForScope","DataMap","getFormattedKey","setAttribute","removeAttribute","replace","char","attributeValueContainsToken","TargetSet","targetName","find","targetNames","getSelectorForTargetNames","findElement","findAll","findAllElements","getSelectorForTargetName","join","targetDescriptor","targetAttribute","Scope","targets","data","head","tail","filterElements","closest","controllerSelector","controllerAttribute","ScopeObserver","scopesByIdentifierByElement","scopeReferenceCounts","scopesByIdentifier","fetchScopesByIdentifierForElement","referenceCount","scopeConnected","scopeDisconnected","Router","scopeObserver","modulesByIdentifier","modules","contexts","loadDefinition","unloadIdentifier","connectModule","disconnectModule","getContextForElementAndIdentifier","defaultSchema","__generator","thisArg","body","f","y","t","g","label","sent","trys","ops","next","verb","throw","return","Symbol","iterator","n","v","op","TypeError","done","pop","push","step","Application","documentElement","router","_arguments","generator","Promise","resolve","readyState","P","reject","fulfilled","rejected","result","then","register","load","rest","definitions","isArray","unload","identifiers","getControllerForElementAndIdentifier","console","defineTargetProperties","ancestors","getPrototypeOf","getAncestorsForConstructor","getOwnTargetNamesForConstructor","name","getTargetNamesForConstructor","object","properties","charAt","toUpperCase","capitalize"],"mappings":"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"}